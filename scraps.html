<html>
<head>
<style>
.permission-action {
margin-left: 2em;
margin-right: 2em;
}
</style>
</head>
<body>

<table id="t">
<thead>
<th>Resource</th>
<th>Actions</th>
</thead>
<tbody>
<tr>

</tr>
</tbody>
</table>
<script>
let state = [];

let permissions = [
{
employee: {
write: 0, read: 0, remove: 0, edit: 0
}
},
{
["employee.credential"]: {
write: 0, read: 0, remove: 0, edit: 0
}
},
{
["employee.roles"]: {
write: 0, read: 0, remove: 0, edit: 0
}
},
]

state = [];


let role = {
name : 'admin',
description: 'Administrator',
permissions: [
{
employee: {
read: 1, write: 1
}
},
{
"employee.roles": {
read: 1,write:1
}
}
]

}
console.log(state);
function permissionActionChangeHandler(e){
console.log(e.target['ht-resource'],e.target['ht-resource-action'],e.target.checked);
//look for the index of the resource,
let i = state.findIndex(permission => { 
return Boolean(permission[e.target['ht-resource']]);
});
console.log(i);
if(i === -1){
//found a permission with the resource name
state.push({
[e.target['ht-resource']] : { [e.target['ht-resource-action']]: e.target.checked }
})
}
console.log(state);

}

function renderPermissions(){
let tbody = document.querySelector("#t tbody");
for(let permission of permissions){
let tr = document.createElement('tr');
 
let resource = Object.getOwnPropertyNames(permission)[0];
let resourceTd = document.createElement('td');


//actions of each permission;
let actions = permission[resource]; 
let actionsTd = document.createElement('td');

let rolePermission = role.permissions.find(permission=> Boolean(permission[resource]));
if(rolePermission){
//overwrite actions
Object.assign(actions,rolePermission[resource]); // 
}
 
 

let actionNames = Object.getOwnPropertyNames(actions);
//for each name,create a checkbox
for(let actionName of actionNames){
let input = document.createElement('input');
input.type = "checkbox";
input.checked = Boolean(actions[actionName]);
input['ht-resource'] = resource;
input['ht-resource-action'] = actionName;
input.addEventListener('change',permissionActionChangeHandler);
let label = document.createElement('label');
label.innerText = actionName;
label.classList.add('permission-action');
label.appendChild(input);    
 
actionsTd.appendChild(label);
 
}
 
resourceTd.innerHTML = resource;
 

tr.appendChild(resourceTd);
tr.appendChild(actionsTd);
 
tbody.appendChild(tr)
 
}

}

renderPermissions();

 

</script>
</body>


</html>
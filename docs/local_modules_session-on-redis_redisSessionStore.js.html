<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: local_modules/session-on-redis/redisSessionStore.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: local_modules/session-on-redis/redisSessionStore.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const redis = require('redis');
const client = redis.createClient();

client.monitor((err,result)=>{
  console.log('Redis Monitor Mode!');
});

client.on('monitor',(time,args,raw_reply)=>{
  console.log(time,' : ',args);
});

/**
 * Save the sessionID together with the session data. Session data are saved as hash field value.
 * 
 * @param {string} sessionID - The sessionID to set
 * @param {object} session - The session object
 */
const set = (sessionID,session) => {
  client.hset(sessionID,'data',JSON.stringify(session),redis.print);
}

/**
 * 
 * @param {string} sessionID - The sessionID to find
 * @param {function} errorResultCallback - error first callback,session found on the store is passed as second parameter
 */
const get = (sessionID,errorResultCallback) => {
  client.exists(sessionID,(error,reply) => {
    if(error) {console.log('store@get',error); errorResultCallback(error);return;}
    if(reply === 1){//sessionID exists
      client.hget(sessionID,'data',(result)=>{
        if(result){
          console.log(result);
          errorResultCallback(null,JSON.parse(result));
        }
      });
    }
  });
}

const getSession = (sessionID)=>{
  return new Promise((resolve,reject)=>{
    client.exists(sessionID,(error,reply) => {
      if(error) {reject({redisError:error})}//redis error
      if(reply === 1){//sessionID exists
        client.hget(sessionID,"data",(hgetError,result)=>{
          if(result){
            console.log('Result=',result);
            resolve(result);
          }else{
            reject({redisError:hgetError});
          }
        });
      }
    });
  });
}

const exists = (sessionID)=>{
  return new Promise((resolve,reject)=>{
    client.exists(sessionID,(error,reply) => {
      if(error) {reject({redisError:error})}//redis error
      if(reply === 1){//sessionID exists
        client.hget(sessionID,"data",(hgetError,result)=>{
          if(result){
            console.log('Result=',result);
            resolve(result);
          }else{
            reject({redisError:hgetError});
          }
        });
      }
    });
  });
}


/**
 * Deletes the sessionID from storage
 * @param {string} sessionID 
 */
const destroy = (sessionID) => {
  client.DEL(sessionID);
}

//allow access to the client 
// module.exports.redisClient = client;
// module.exports.set = set;
// module.exports.get = get;
// module.exports.getSession = getSession;
// module.exports.destroy = destroy;


Object.defineProperty(module.exports,'redisClient',{writable:false,value:client});
Object.defineProperty(module.exports,'set',{writable:false,value:set});
Object.defineProperty(module.exports,'get',{writable:false,value:get});
Object.defineProperty(module.exports,'getSession',{writable:false,value:getSession});
Object.defineProperty(module.exports,'destroy',{writable:false,value:destroy});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Authentication.html">Authentication</a></li><li><a href="module-Authentication_authenticate.html">Authentication/authenticate</a></li><li><a href="module-Authentication_login.html">Authentication/login</a></li><li><a href="module-Authentication_logout.html">Authentication/logout</a></li><li><a href="module-authorization.html">authorization</a></li><li><a href="module-session-on-redis.html">session-on-redis</a></li><li><a href="module-session-on-redis_sessionCipher.html">session-on-redis/sessionCipher</a></li></ul><h3>Classes</h3><ul><li><a href="Artifact.html">Artifact</a></li><li><a href="Artifact.Message.html">Message</a></li><li><a href="Policy.html">Policy</a></li><li><a href="PolicyViolation.html">PolicyViolation</a></li><li><a href="Rule.html">Rule</a></li></ul><h3>Namespaces</h3><ul><li><a href="HT.html">HT</a></li><li><a href="Services.html">Services</a></li></ul><h3>Global</h3><ul><li><a href="global.html#config">config</a></li><li><a href="global.html#db">db</a></li><li><a href="global.html#destroy">destroy</a></li><li><a href="global.html#genuuidV4">genuuidV4</a></li><li><a href="global.html#get">get</a></li><li><a href="global.html#getMiddleware">getMiddleware</a></li><li><a href="global.html#getServices">getServices</a></li><li><a href="global.html#handleNonXHR">handleNonXHR</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#prefixPath">prefixPath</a></li><li><a href="global.html#set">set</a></li><li><a href="global.html#start">start</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Mar 15 2019 23:37:08 GMT+0300 (Arabian Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
